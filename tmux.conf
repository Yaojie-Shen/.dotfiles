# Getting colors in tmux
set -g default-terminal "screen-256color"

set -g mouse on

# Enable more history
set -g history-limit 50000

# Set window and panel index to start at 1
set -g base-index 1
setw -g pane-base-index 1

# Beautify status bar
set-option -g status-bg black
set-option -g status-fg white
set-option -g status-left-style bold
set-option -g status-right '#H | %Y-%m-%d %H:%M'

# Show system resource info (CPU, GPU, MEM) in the tmux status bar
set -g status-right 'CPU: #( \
if top -bn1 >/dev/null 2>&1; then \
  top -bn1 | grep "Cpu(s)" | awk "{print \$2 + \$4}"; \
else \
  echo "N/A"; \
fi \
) | MEM: #( \
if free -m >/dev/null 2>&1; then \
  free -m | awk "/Mem:/ { printf(\"%3.1f%%\", \$3/\$2*100) }"; \
else \
  echo "N/A"; \
fi \
) | GPU: #( \
if command -v nvidia-smi >/dev/null 2>&1; then \
  GPU_MEM=$(nvidia-smi --query-gpu=memory.used,memory.total --format=csv,noheader,nounits | \
    awk "{used+=\$1; total+=\$2} END {if(total>0) print int(used/total*100)}"); \
  GPU_LOAD=$(nvidia-smi --query-gpu=utilization.gpu --format=csv,noheader,nounits | \
    awk "{sum+=\$1; count++} END {if(count>0) print int(sum/count)}"); \
  if [ -n "$GPU_MEM" ] && [ -n "$GPU_LOAD" ]; then \
    echo "${GPU_LOAD}% / ${GPU_MEM}%"; \
  else \
    echo "N/A"; \
  fi; \
else \
  echo "N/A"; \
fi \
) | %Y-%m-%d %H:%M %Z'
# Refresh status bar every 2 seconds
set -g status-interval 2
# Expand status-right display width to avoid text truncation
set -g status-right-length 60

# Highlight the active window in the status bar
set -g window-status-current-format "#[fg=black,bg=yellow,bold] #I:#W #[default]"
# Style for inactive windows
set -g window-status-format "#[fg=white]#I:#W#[default]"

# Enable activity monitoring to track window output
setw -g monitor-activity on
# Disable visual bell for activity
set -g visual-activity off

# Set pane selection indicator (prefix + q) to display for 5 seconds
set -g display-panes-time 5000

# Move between panes with Ctrl+b + h/j/k/l
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize using arrow keys with dynamic step
bind Left command-prompt -p "Resize left by (default 40):" \
    "run 'n=%1; [ -z \"\$n\" ] && n=40; tmux resize-pane -L \$n'"
bind Right command-prompt -p "Resize right by (default 40):" \
    "run 'n=%1; [ -z \"\$n\" ] && n=40; tmux resize-pane -R \$n'"
bind Up command-prompt -p "Resize up by (default 10):" \
    "run 'n=%1; [ -z \"\$n\" ] && n=10; tmux resize-pane -U \$n'"
bind Down command-prompt -p "Resize down by (default 10):" \
    "run 'n=%1; [ -z \"\$n\" ] && n=10; tmux resize-pane -D \$n'"

# Use Ctrl+Shift+Left/Right to move the current window to left/right.
# More info: https://superuser.com/questions/343572/how-do-i-reorder-tmux-windows
bind-key -n C-S-Left swap-window -t -1\; select-window -t -1
bind-key -n C-S-Right swap-window -t +1\; select-window -t +1

# Default is too slow which is annoying during heavy-use of the nvim in tmux.
set-option -s escape-time 0
